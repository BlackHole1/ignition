# See the documentation for more information:
# https://packit.dev/docs/configuration/
actions:
    post-upstream-clone:
        - "wget https://src.fedoraproject.org/rpms/ignition/raw/rawhide/f/ignition.spec -O ignition.spec"
        - "wget https://src.fedoraproject.org/rpms/ignition/raw/rawhide/f/go-mods-to-bundled-provides.py -O go-mods-to-bundled-provides.py"
        - "chmod +x go-mods-to-bundled-provides.py"
        - "./go-mods-to-bundled-provides.py | sort > newReleaseProvides"
        - "sed -i '/^Provides: bundled/d' ignition.spec"
        - "sed -i '/^# Generated by `go-mods-to-bund/ r newReleaseProvides' ignition.spec"

specfile_path: ignition.spec

upstream_tag_template: v{version}

# add or remove files that should be synced
files_to_sync:
    - ignition.spec
    - .packit.yaml

# name in upstream package repository or registry (e.g. in PyPI)
upstream_package_name: ignition
# downstream (Fedora) RPM package name
downstream_package_name: ignition

jobs: 

- job: propose_downstream
  trigger: release
  dist_git_branches:
    - fedora-rawhide
    - fedora-stable

- job: koji_build
  trigger: commit
  dist_git_branches:
    - fedora-stable

- job: bodhi_update
  trigger: commit
  dist_git_branches:
    - fedora-stable